# üìò React Query Integration Documentation

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –±—ã–ª –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å React Query (@tanstack/react-query) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏—è UX.

–ù–∏–∂–µ –æ–ø–∏—Å–∞–Ω–æ, –∫–∞–∫ –±—ã–ª–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –∫–∞–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –æ–Ω–∞ –¥–∞–ª–∞ –∏ –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ query key.

# üöÄ –ü–æ—á–µ–º—É –±—ã–ª –≤—ã–±—Ä–∞–Ω React Query

–î–æ React Query –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤—ã–≥–ª—è–¥–µ–ª–∞ —Ç–∞–∫:

```useEffect(() => {
  fetch('/api/posts')
    .then(res => res.json())
    .then(data => setPosts(data));
}, []);
```

## ‚ùå –ú–∏–Ω—É—Å—ã –¥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
	‚Ä¢	–ú–Ω–æ–≥–æ —Ä—É—á–Ω–æ–≥–æ –∫–æ–¥–∞
	‚Ä¢	–ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∞ –¥–∞–Ω–Ω—ã—Ö
	‚Ä¢	–ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
	‚Ä¢	–ù–µ –±—ã–ª–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
	‚Ä¢	–û—à–∏–±–∫–∏ –Ω—É–∂–Ω–æ –±—ã–ª–æ –ª–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é
	‚Ä¢	–°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

# ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è React Query

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–æ—è–≤–∏–ª—Å—è –µ–¥–∏–Ω—ã–π —Ü–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ ‚Äî QueryClient:

```const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 2,
      refetchOnWindowFocus: false,
      staleTime: 1000 * 60,
    },
  },
});
```
–¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å:
```
const { data } = useQuery({
  queryKey: ['posts'],
  queryFn: getPosts,
});
```
–î–∞—ë—Ç –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úî –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ ‚Äî –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–µ—à–∞.

‚úî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–ü–æ refetchInterval –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ invalidate.

‚úî –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

React Query –Ω–µ –¥–µ–ª–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

‚úî –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –æ—à–∏–±–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.

‚úî Select, dependent queries, prefetch

‚Äî –ø–æ–≤—ã—à–∞—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ UX.

# üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### queryClient.js

–ó–¥–µ—Å—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è QueryClient (retry, –æ—à–∏–±–∫–∏, devtools).
```
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 2,
      staleTime: 60 * 1000,
      refetchOnWindowFocus: false,
    },
  },
});
```
# üîë –õ–æ–≥–∏–∫–∞ queryKey

### [‚Äòposts‚Äô]

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å—Ç–æ–≤, prefetch, invalidate.

–ß—Ç–æ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è: –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤
–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, SearchPosts, create/update/delete



### [‚Äòposts‚Äô, search]

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –ø–æ–∏—Å–∫–∞.

### –ß—Ç–æ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è: –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ —Å—Ç—Ä–æ–∫–µ –ø–æ–∏—Å–∫–∞
### –ü–æ—á–µ–º—É —Ç–∞–∫:
	‚Ä¢	–ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–≤–æ–¥–µ –≤ –ø–æ–ª–µ –∫–ª—é—á –º–µ–Ω—è–µ—Ç—Å—è
	‚Ä¢	React Query —Å–æ–∑–¥–∞—ë—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —è—á–µ–π–∫—É –∫–µ—à–∞
	‚Ä¢	–µ—Å–ª–∏ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å —É–∂–µ –¥–µ–ª–∞–ª—Å—è ‚Äî –æ–Ω –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π




# üéõ –ü—Ä–∏–º–µ—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

## 1Ô∏è‚É£ Select (–∏–∑–±–µ–∂–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤)
```
select: (data) =>
  data.map(post => ({ id: post.id, title: post.title })),
```
## 2Ô∏è‚É£ Prefetching
```
queryClient.prefetchQuery(['posts'], getPosts);
```
## 3Ô∏è‚É£ Dependent Query
```
enabled: !!userId
```
## 4Ô∏è‚É£ Retry –ª–æ–≥–∏–∫–∞
```
retry: 2
```
## 5Ô∏è‚É£ –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í queryClient:
```
queryCache: {
  onError: (error, query) => {
    toast.error(`–û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ: ${query.queryKey}`);
  },
},
```
# üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –î–û vs –ü–û–°–õ–ï
| –ú–µ—Ç—Ä–∏–∫–∞                     | –î–æ React Query | –ü–æ—Å–ª–µ React Query |
|-----------------------------|----------------|-----------------|
| –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã   | 5‚Äì10 —Ä–∞–∑       | 0‚Äì1 (–∫–µ—à)       |
| –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏   | –º–µ–¥–ª–µ–Ω–Ω—ã–µ      | –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ      |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞           | –≤—Ä—É—á–Ω—É—é        | –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ  |
| –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | –Ω–µ—Ç            | –µ—Å—Ç—å            |
| –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ                 | –Ω–µ—Ç            | –µ—Å—Ç—å            |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤       | —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä  | —á–µ—Ä–µ–∑ DevTools  |

# üîß React Query DevTools

DevTools –¥–æ–±–∞–≤–ª–µ–Ω—ã:
```
<ReactQueryDevtools initialIsOpen={false} />
```
## –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å:
	‚Ä¢	–∑–∞–ø—Ä–æ—Å—ã
	‚Ä¢	–∫–µ—à
	‚Ä¢	stale/fresh
	‚Ä¢	–æ—à–∏–±–∫–∏
	‚Ä¢	–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

# üìÑ –ò—Ç–æ–≥

### React Query –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏–ª —Ä—É—á–Ω—É—é —Ä–∞–±–æ—Ç—É —Å fetch/useEffect –∏ –¥–∞–ª:

‚úî —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
‚úî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
‚úî –º–æ—â–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úî —É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ –º—É—Ç–∞—Ü–∏–∏
‚úî –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É (prefetch)
‚úî –∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã
‚úî –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
‚úî DevTools –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–µ—Ç–∏

# C–∫—Ä–∏–Ω—à–æ—Ç DevTools —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
![DevTools](./public//readme_img/devtools.png "DevTools")

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
##### –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **type-based architecture** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤.

###### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–∫—Ä–∞—Ç–∫–æ):
```
src/
  api/
  components/
  hooks/
  pages/
  redux/
    slices/
    thunks/
    selectors/
```
#### –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —Ñ–∞–π–ª–µ:

üëâ **ARCHITECTURE.md**